<!DOCTYPE html>
<html lang="zxx" class="js">

<head>
    <?php include('_meta.php') ?>
</head>

<body class="nk-body npc-crypto has-sidebar has-sidebar-fat ui-clean ">
    <div class="nk-app-root">
        <!-- main @s -->
        <div class="nk-main ">
            <?php include('_slidebare.php') ?>
            <!-- wrap @s -->
            <div class="nk-wrap ">
                <?php include('_header.php') ?>
                <!-- content @s -->

                <div class="nk-content nk-content-fluid">
                    <div class="container-xl wide-lg">
                        <div class="nk-content-body">
                              

                            <div class="align-center flex-wrap flex-md-nowrap g-4">
                                <div class="nk-block-image w-120px flex-shrink-0">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 118">
                                        <path d="M8.916,94.745C-.318,79.153-2.164,58.569,2.382,40.578,7.155,21.69,19.045,9.451,35.162,4.32,46.609.676,58.716.331,70.456,1.845,84.683,3.68,99.57,8.694,108.892,21.408c10.03,13.679,12.071,34.71,10.747,52.054-1.173,15.359-7.441,27.489-19.231,34.494-10.689,6.351-22.92,8.733-34.715,10.331-16.181,2.192-34.195-.336-47.6-12.281A47.243,47.243,0,0,1,8.916,94.745Z" transform="translate(0 -1)" fill="#f6faff"></path>
                                        <rect x="18" y="32" width="84" height="50" rx="4" ry="4" fill="#fff"></rect>
                                        <rect x="26" y="44" width="20" height="12" rx="1" ry="1" fill="#e5effe"></rect>
                                        <rect x="50" y="44" width="20" height="12" rx="1" ry="1" fill="#e5effe"></rect>
                                        <rect x="74" y="44" width="20" height="12" rx="1" ry="1" fill="#e5effe"></rect>
                                        <rect x="38" y="60" width="20" height="12" rx="1" ry="1" fill="#e5effe"></rect>
                                        <rect x="62" y="60" width="20" height="12" rx="1" ry="1" fill="#e5effe"></rect>
                                        <path d="M98,32H22a5.006,5.006,0,0,0-5,5V79a5.006,5.006,0,0,0,5,5H52v8H45a2,2,0,0,0-2,2v4a2,2,0,0,0,2,2H73a2,2,0,0,0,2-2V94a2,2,0,0,0-2-2H66V84H98a5.006,5.006,0,0,0,5-5V37A5.006,5.006,0,0,0,98,32ZM73,94v4H45V94Zm-9-2H54V84H64Zm37-13a3,3,0,0,1-3,3H22a3,3,0,0,1-3-3V37a3,3,0,0,1,3-3H98a3,3,0,0,1,3,3Z" transform="translate(0 -1)" fill="#798bff"></path>
                                        <path d="M61.444,41H40.111L33,48.143V19.7A3.632,3.632,0,0,1,36.556,16H61.444A3.632,3.632,0,0,1,65,19.7V37.3A3.632,3.632,0,0,1,61.444,41Z" transform="translate(0 -1)" fill="#6576ff"></path>
                                        <path d="M61.444,41H40.111L33,48.143V19.7A3.632,3.632,0,0,1,36.556,16H61.444A3.632,3.632,0,0,1,65,19.7V37.3A3.632,3.632,0,0,1,61.444,41Z" transform="translate(0 -1)" fill="none" stroke="#6576ff" stroke-miterlimit="10" stroke-width="2"></path>
                                        <line x1="40" y1="22" x2="57" y2="22" fill="none" stroke="#fffffe" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line>
                                        <line x1="40" y1="27" x2="57" y2="27" fill="none" stroke="#fffffe" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line>
                                        <line x1="40" y1="32" x2="50" y2="32" fill="none" stroke="#fffffe" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line>
                                        <line x1="30.5" y1="87.5" x2="30.5" y2="91.5" fill="none" stroke="#9cabff" stroke-linecap="round" stroke-linejoin="round"></line>
                                        <line x1="28.5" y1="89.5" x2="32.5" y2="89.5" fill="none" stroke="#9cabff" stroke-linecap="round" stroke-linejoin="round"></line>
                                        <line x1="79.5" y1="22.5" x2="79.5" y2="26.5" fill="none" stroke="#9cabff" stroke-linecap="round" stroke-linejoin="round"></line>
                                        <line x1="77.5" y1="24.5" x2="81.5" y2="24.5" fill="none" stroke="#9cabff" stroke-linecap="round" stroke-linejoin="round"></line>
                                        <circle cx="90.5" cy="97.5" r="3" fill="none" stroke="#9cabff" stroke-miterlimit="10"></circle>
                                        <circle cx="24" cy="23" r="2.5" fill="none" stroke="#9cabff" stroke-miterlimit="10"></circle></svg>
                                </div>
                                <div class="nk-block-content">
                                    <div class="nk-block-content-head px-lg-4">
                                        <h5>Paramètrage des informations</h5>
	                                      <p class="text-soft">Les informations enregistrées dans cette section seront nécessaires pour la recherche des données difusées par la radio.
	                                         <a href="" class="btn btn-default btn-sm">
	                                         	<i class="fa fa-refresh"></i> actualiser
	                                         </a>
	                                     </p>
                                    </div>
                                </div>
                                <div class="nk-block-content flex-shrink-0">
                                    <a href="javascript:void(0);" role="button" id="add_button" data-toggle="modal" data-target="#userModal" class="btn btn-lg btn-outline-primary">Enregistrez l'opération</a>
                                </div>
                            </div>  


                            <div class="align-center flex-wrap flex-md-nowrap g-4">

                            	<div class="col-lg-12 col-xs-12 col-md-12">
                            		<div class="table-responsive">

                            			<table id="user_data" class="table table-member">
                            				<thead class="tb-member-head thead-light">  
					                            <tr>  
					                                 <th width="10%">Image</th>  
					                                 <th width="20%">Nom info</th>
					                                 <th width="20%">Description info</th>
					                                 <th width="20%">Fichier info</th>
					                                 <th width="5%">Code link</th>
					                                 <th width="15%">Mis à jour</th>
					                                 <th width="5%">Editer</th>  
					                                 <th width="5%">Del</th>  
					                            </tr>  
					                       </thead>
					                       <tbody>
					                       	<?php 
					                       	$this->db->order_by("id_info", "desc");
					                       	$qury= $this->db->get("information")->result_array();
					                       	foreach ($qury as $key ) {
					                       		?>
					                       		<tr class="tb-member-item">
					                       			<td class="tb-member-info"><img src="<?php echo(base_url()) ?>upload/information/<?php echo($key['logo_info']) ?>" class="img-thumbnail" style="width: 50px; height: 35px;"></td>

						                       		<td class="tb-member-info"><?php echo(substr($key['nom_info'], 0,10)) ?>...</td>
						                       		<td class="tb-member-info"><?php echo(substr($key['description_info'], 0,10)) ?>...</td>
						                       		<td class="tb-member-info"><?php echo(substr($key['fichier_info'], 0,10)) ?>...</td>
						                       		<td class="tb-member-info"><?php echo(substr($key['code_link'], 0,10)) ?>...</td>
						                       		<td class="tb-member-info"><?php echo(nl2br(substr(date(DATE_RFC822, strtotime($key['created_at'])), 0, 23))) ?></td>
						                       		
						                       		<td class="tb-member-info">
						                       			<a href="javascript:void(0)" class="btn btn-warning btn-sm update" id_info="<?php echo($key['id_info']) ?>"><i class="fa fa-edit"></i></a>
						                       		</td>

						                       		<td class="tb-member-info">
						                       			<a href="javascript:void(0)" class="btn btn-danger btn-sm delete" id_info="<?php echo($key['id_info']) ?>"><i class="fa fa-trash"></i></a>
						                       		</td>

					                       		</tr>
					                       		<?php
					                       	}
					                       	 ?>
					                       </tbody>  
                            			</table>
                            			
                            		</div>
                            	</div>


                            </div>  
                           
                            

                        </div>
                    </div>
                </div>


                
                <!-- content @e -->

                <?php include('_footer.php') ?>
                
            </div>
            <!-- wrap @e -->
        </div>
        <!-- main @e -->
    </div>
    <!-- app-root @e -->
    <!-- JavaScript -->


    <!-- modal ajout radio -->
    <div class="modal fade" tabindex="-1" role="dialog" id="userModal">
        <div class="modal-dialog modal-dialog-centered modal-md" role="document">
            <div class="modal-content">
                <a href="#" class="close" data-dismiss="modal"><em class="icon ni ni-cross-sm"></em></a>
                <div class="modal-body modal-body-lg">
                    <div class="nk-block-head nk-block-head-xs text-center">
                        <span class="nk-block-title modal-title">Paramètrage des informations</span>
                        
                    </div>
                    <div class="nk-block">

                    	<form method="post" id="user_form" enctype="multipart/form-data" class="col-md-12 row">
                    		
                    		<div class="col-md-12">
                    			<div class="input-group flex-nowrap mb-2">
  								  <div class="input-group-prepend">
  								    <span class="input-group-text" id="addon-wrapping"><i class="fa fa-pencil"></i></span>
  								  </div>
  								  <input type="text" name="nom_info" id="nom_info" class="form-control" placeholder="Titre de l'information" aria-label="titre de l'information" aria-describedby="addon-wrapping">
  								</div>
                    		</div>

                    		<div class="col-md-12">
                    			<div class="input-group flex-nowrap mb-2">
  								  <div class="input-group-prepend">
  								    <span class="input-group-text" id="addon-wrapping"><i class="fa fa-globe"></i></span>
  								  </div>
  								   <input type="text" name="fichier_info" id="fichier_info" class="form-control" placeholder="le vrai lien de l'information" aria-label="le vrai lien de l'information" aria-describedby="addon-wrapping">
  								</div>
                    		</div>


                    		<div class="col-md-12">
                    			<div class="input-group flex-nowrap mb-2">
  								  <div class="input-group-prepend">
  								    <span class="input-group-text" id="addon-wrapping"><i class="fa fa-envelope"></i></span>
  								  </div>
  								   <textarea name="description_info" id="description_info" class="form-control" placeholder="Détail de l'information"></textarea>
  								</div>
                    		</div>

                    		

                    		

                    		<div class="col-md-12">
                    			<div class="input-group flex-nowrap mb-2">
  								  <div class="input-group-prepend">
  								    <span class="input-group-text" id="addon-wrapping"><i class="fa fa-camera"></i></span>
  								  </div>
  								   <input type="file" name="user_image" id="user_image" class="form-control" placeholder="le logo de l'information" aria-label="logo de la rdio" aria-describedby="addon-wrapping">
  								   
  								</div>
                    		</div>
                    		

                    		<div class="col-md-12">
                    			<div class="row">
                    				<div class="col-md-4"></div>
                    				<div class="col-md-4">

                    					<div class="buysell-field form-action text-center mb-2">
				                            <div>

				                            	<span class="text-center" id="user_uploaded_image"></span>
				                            </div>
				                           
				                        </div>
                    					
                    				</div>
                    				<div class="col-md-4"></div>
                    			</div>
                    			
                    		</div>

                    		<div class="col-md-12" style="margin-bottom: 20px;">
                    			<div class="row">
                    				<div class="col-md-4"></div>
                    				<div class="col-md-4">

                    					<div class="buysell-field form-action text-center mb-2">
				                            <div>

				                            	<input type="hidden" name="id_info" id="id_info" />  
			                    				<input type="submit" name="action" id="action" class="btn btn-primary btn-lg" value="Add" />
				                            </div>
				                            <div class="pt-3">
				                                <a href="javascript:void(0);" data-dismiss="modal" class="link link-danger">Annuler l'opération</a>
				                            </div>
				                        </div>
                    					
                    				</div>
                    				<div class="col-md-4"></div>
                    			</div>
                    		</div>





                    	</form>
                        
                        
                        
                    </div><!-- .nk-block -->
                </div><!-- .modal-body -->
            </div><!-- .modal-content -->
        </div><!-- .modla-dialog -->
    </div>
    <!-- fin modal-->




    <?php include('_script.php') ?>


    <script type="text/javascript" language="javascript" >  
 	 $(document).ready(function(){  
      $('#add_button').click(function(){  
           $('#user_form')[0].reset();  
           $('.modal-title').text("Paramètrage des informations");  
           $('#action').val("Add");  
      });

      var dataTable = $('#user_data').DataTable();

      $(document).on('submit', '#user_form', function(event){  
           event.preventDefault(); 
           var nom_info 		= $('#nom_info').val();
           var fichier_info		= $('#fichier_info').val();
           var description_info = $('#description_info').val();
          
           var extension = $('#user_image').val().split('.').pop().toLowerCase(); 
           var action = $('#action').val();


           if(extension != '')  
           {  
                if(jQuery.inArray(extension, ['gif','png','jpg','jpeg']) == -1)  
                {  
                     // alert("Invalid Image File"); 
                     swal("Oups!!!", "erreur liée au format de logo", 'error');  
                     $('#user_image').val('');  
                     return false;  
                }  
           } 

           // alert(nom_info+" "+action);


           if(nom_info != '' && fichier_info != '' && description_info != '')
            {

	            if (action =="Add") {
	                 
	                $.ajax({  
	                     url:"<?php echo base_url() . 'admin/insertion_information'?>",  
	                     method:'POST',  
	                     data:new FormData(this),  
	                     contentType:false,  
	                     processData:false,  
	                     success:function(data)  
	                     {  
	                          swal("succès", ''+data, 'success');  
	                          $('#user_form')[0].reset();  
	                          $('#userModal').modal('hide');  
	                          // dataTable.ajax.reload();  
	                     }  
	                });
	                  // alert("insertion");

	            }
		        else if (action == 'Edit') {
		        	$.ajax({  
                         url:"<?php echo base_url() . 'admin/modification_information'?>",  
                         method:'POST',  
                         data:new FormData(this),  
                         contentType:false,  
                         processData:false,  
                         success:function(data)  
                         {  
                              swal("succès", ''+data, 'success');  
                              $('#user_form')[0].reset();  
                              $('#userModal').modal('hide');  
                              // dataTable.ajax.reload();  
                         }  
                    });
	            }

            }
            else
            {
            	// alert("Tous les champs doivent être remplis ");
            	swal("Erreur!!!", "Tous les champs doivent être remplis", "error"); 
            }
             
      }); 

      $(document).on('click', '.update', function(){  
           var id_info = $(this).attr("id_info");  
           $.ajax({  
                url:"<?php echo base_url(); ?>admin/fetch_single_information",  
                method:"POST",  
                data:{id_info:id_info},  
                dataType:"json",  
                success:function(data)  
                {  
                     $('#userModal').modal('show');  
                     $('#nom_info').val(data.nom_info);
                     $('#fichier_info').val(data.fichier_info);
                     $('#description_info').val(data.description_info);
                     $('#user_uploaded_image').html(data.user_image);

                     $('.modal-title').text("modification de la radio");  
                     $('#id_info').val(id_info);  
                     $('#action').val("Edit");  
                }  
           });  
      });

      $(document).on('click', '.delete', function(){
          var id_info = $(this).attr("id_info");

          	swal({
		        title: "Êtes-vous sûr?",
		        text: "Vous ne pourrez pas récupérer ces données provinciales!",
		        type: "warning",
		        showCancelButton: true,
		        confirmButtonColor: "#dc3545",
		        confirmButtonText: "Oui, supprimez-le!",
		        cancelButtonText: "Non, annulez!",
		        closeOnConfirm: false,
		        closeOnCancel: false
		    }, function (isConfirm) {
		        if (isConfirm) {

		        	$.ajax({
		              url:"<?php echo base_url(); ?>admin/supression_information",
		              method:"POST",
		              data:{id_info:id_info},
		              success:function(data)
		              {
		                 swal("succès!", ''+data, "success");
		                 // dataTable.ajax.reload();
		              }
		            });
		           
		        } else {
		            swal("Ouf!!!", "opération annulée :)", "error");
		        }
		    });
      });

	
 });  
 </script>

</body>

</html>